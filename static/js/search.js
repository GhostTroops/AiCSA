function FnClick(o){
    if(-1 < String(location).indexOf("torrent")){ // 种子文件下载
        open('magnet:?xt=urn:btih:'+o.innerText+'&tr=udp%3A%2F%2Ftracker.opentrackr.org%3A1337%2Fannounce&tr=&tr=http%3A%2F%2Ftracker.opentrackr.org%3A1337%2Fannounce&tr=udp%3A%2F%2F9.rarbg.com%3A2810%2Fannounce&tr=udp%3A%2F%2Fopentracker.i2p.rocks%3A6969%2Fannounce&tr=https%3A%2F%2Fopentracker.i2p.rocks%3A443%2Fannounce&tr=udp%3A%2F%2Ftracker.torrent.eu.org%3A451%2Fannounce&tr=udp%3A%2F%2Ftracker.openbittorrent.com%3A6969%2Fannounce&tr=udp%3A%2F%2Fopen.tracker.cl%3A1337%2Fannounce&tr=udp%3A%2F%2Fopen.stealth.si%3A80%2Fannounce&tr=http%3A%2F%2Ftracker.openbittorrent.com%3A80%2Fannounce&tr=udp%3A%2F%2Ftracker.moeking.me%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.dler.org%3A6969%2Fannounce&tr=udp%3A%2F%2Fp4p.arenabg.com%3A1337%2Fannounce&tr=udp%3A%2F%2Fopen.demonii.com%3A1337%2Fannounce&tr=udp%3A%2F%2Fmovies.zsw.ca%3A6969%2Fannounce&tr=udp%3A%2F%2Fipv4.tracker.harry.lu%3A80%2Fannounce&tr=udp%3A%2F%2Fexplodie.org%3A6969%2Fannounce&tr=udp%3A%2F%2Fexodus.desync.com%3A6969%2Fannounce&tr=udp%3A%2F%2Fbt2.archive.org%3A6969%2Fannounce&tr=https%3A%2F%2Ftracker.nanoha.org%3A443%2Fannounce&tr=https%3A%2F%2Ftracker.lilithraws.org%3A443%2Fannounce&tr=https%3A%2F%2Ftr.burnabyhighstar.com%3A443%2Fannounce&tr=http%3A%2F%2Ftracker.mywaifu.best%3A6969%2Fannounce&tr=http%3A%2F%2Ftracker.dler.org%3A6969%2Fannounce&tr=udp%3A%2F%2Fzecircle.xyz%3A6969%2Fannounce&tr=udp%3A%2F%2Fwww.peckservers.com%3A9000%2Fannounce&tr=udp%3A%2F%2Fv2.iperson.xyz%3A6969%2Fannounce&tr=udp%3A%2F%2Fuploads.gamecoast.net%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker2.dler.org%3A80%2Fannounce&tr=udp%3A%2F%2Ftracker1.myporn.club%3A9337%2Fannounce&tr=udp%3A%2F%2Ftracker1.bt.moack.co.kr%3A80%2Fannounce&tr=udp%3A%2F%2Ftracker.theoks.net%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.tcp.exchange%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.swateam.org.uk%3A2710%2Fannounce&tr=udp%3A%2F%2Ftracker.srv00.com%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.skyts.net%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.publictracker.xyz%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.pomf.se%3A80%2Fannounce&tr=udp%3A%2F%2Ftracker.openbtba.com%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.monitorit4.me%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.lelux.fi%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.leech.ie%3A1337%2Fannounce&tr=udp%3A%2F%2Ftracker.joybomb.tw%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.jonaslsa.com%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.ddunlimited.net%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.bitsearch.to%3A1337%2Fannounce&tr=udp%3A%2F%2Ftracker.auctor.tv%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.artixlinux.org%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.altrosky.nl%3A6969%2Fannounce&tr=udp%3A%2F%2Ftracker.4.babico.name.tr%3A3131%2Fannounce&tr=udp%3A%2F%2Ftracker-udp.gbitt.info%3A80%2Fannounce&tr=udp%3A%2F%2Ftr.cili001.com%3A8070%2Fannounce&tr=udp%3A%2F%2Ftr.bangumi.moe%3A6969%2Fannounce&tr=udp%3A%2F%2Ftorrents.artixlinux.org%3A6969%2Fannounce&tr=udp%3A%2F%2Ftorrentclub.space%3A6969%2Fannounce&tr=udp%3A%2F%2Fthouvenin.cloud%3A6969%2Fannounce&tr=udp%3A%2F%2Fthemaninashed.com%3A6969%2Fannounce&tr=udp%3A%2F%2Ftamas3.ynh.fr%3A6969%2Fannounce&tr=udp%3A%2F%2Fslicie.icon256.com%3A8000%2Fannounce&tr=udp%3A%2F%2Fsanincode.com%3A6969%2Fannounce&tr=udp%3A%2F%2Frun.publictracker.xyz%3A6969%2Fannounce&tr=udp%3A%2F%2Frun-2.publictracker.xyz%3A6969%2Fannounce&tr=udp%3A%2F%2Frep-art.ynh.fr%3A6969%2Fannounce&tr=udp%3A%2F%2Fqtstm32fan.ru%3A6969%2Fannounce&tr=udp%3A%2F%2Fpublic.publictracker.xyz%3A6969%2Fannounce&tr=udp%3A%2F%2Fpsyco.fr%3A6969%2Fannounce&tr=udp%3A%2F%2Fopen.tracker.ink%3A6969%2Fannounce&tr=udp%3A%2F%2Fopen.free-tracker.ga%3A6969%2Fannounce&tr=udp%3A%2F%2Fopen.dstud.io%3A6969%2Fannounce&tr=udp%3A%2F%2Fnew-line.net%3A6969%2Fannounce&tr=udp%3A%2F%2Fmoonburrow.club%3A6969%2Fannounce&tr=udp%3A%2F%2Fmirror.aptus.co.tz%3A6969%2Fannounce&tr=udp%3A%2F%2Fmail.zasaonsk.ga%3A6969%2Fannounce&tr=udp%3A%2F%2Fmail.artixlinux.org%3A6969%2Fannounce&tr=udp%3A%2F%2Flaze.cc%3A6969%2Fannounce&tr=udp%3A%2F%2Fkokodayo.site%3A6969%2Fannounce&tr=udp%3A%2F%2Fhtz3.noho.st%3A6969%2Fannounce&tr=udp%3A%2F%2Ffh2.cmp-gaming.com%3A6969%2Fannounce&tr=udp%3A%2F%2Ffe.dealclub.de%3A6969%2Fannounce&tr=udp%3A%2F%2Ff1sh.de%3A6969%2Fannounce&tr=udp%3A%2F%2Fepider.me%3A6969%2Fannounce&tr=udp%3A%2F%2Fdownload.nerocloud.me%3A6969%2Fannounce&tr=udp%3A%2F%2Fcutscloud.duckdns.org%3A6969%2Fannounce&tr=udp%3A%2F%2Fconcen.org%3A6969%2Fannounce&tr=udp%3A%2F%2Fchouchou.top%3A8080%2Fannounce&tr=udp%3A%2F%2Fcarr.codes%3A6969%2Fannounce&tr=udp%3A%2F%2Fcamera.lei001.com%3A6969%2Fannounce&tr=udp%3A%2F%2Fbt1.archive.org%3A6969%2Fannounce&tr=udp%3A%2F%2Fbt.ktrackers.com%3A6666%2Fannounce&tr=udp%3A%2F%2Fblack-bird.ynh.fr%3A6969%2Fannounce&tr=udp%3A%2F%2Fastrr.ru%3A6969%2Fannounce&tr=udp%3A%2F%2Fadmin.52ywp.com%3A6969%2Fannounce&tr=udp%3A%2F%2Faarsen.me%3A6969%2Fannounce&tr=https%3A%2F%2Ftracker.tamersunion.org%3A443%2Fannounce&tr=https%3A%2F%2Ftracker.moeblog.cn%3A443%2Fannounce&tr=https%3A%2F%2Ftracker.lelux.fi%3A443%2Fannounce&tr=https%3A%2F%2Ftracker.kuroy.me%3A443%2Fannounce&tr=https%3A%2F%2Ftracker.gbitt.info%3A443%2Fannounce&tr=https%3A%2F%2Ftracker.foreverpirates.co%3A443%2Fannounce&tr=https%3A%2F%2F1337.abcvg.info%3A443%2Fannounce&tr=http%3A%2F%2Fwww.peckservers.com%3A9000%2Fannounce&tr=http%3A%2F%2Fwepzone.net%3A6969%2Fannounce&tr=http%3A%2F%2Fvps02.net.orel.ru%3A80%2Fannounce&tr=http%3A%2F%2Ftracker3.ctix.cn%3A8080%2Fannounce&tr=http%3A%2F%2Ftracker2.dler.org%3A80%2Fannounce&tr=http%3A%2F%2Ftracker1.bt.moack.co.kr%3A80%2Fannounce&tr=http%3A%2F%2Ftracker.skyts.net%3A6969%2Fannounce&tr=http%3A%2F%2Ftracker.lelux.fi%3A80%2Fannounce&tr=http%3A%2F%2Ftracker.gbitt.info%3A80%2Fannounce&tr=http%3A%2F%2Ftracker.files.fm%3A6969%2Fannounce&tr=http%3A%2F%2Ftracker.edkj.club%3A6969%2Fannounce&tr=http%3A%2F%2Ftracker.bt4g.com%3A2095%2Fannounce&tr=http%3A%2F%2Ftr.cili001.com%3A8070%2Fannounce&tr=http%3A%2F%2Ft.overflow.biz%3A6969%2Fannounce&tr=http%3A%2F%2Ft.acg.rip%3A6699%2Fannounce&tr=http%3A%2F%2Fopen.tracker.ink%3A6969%2Fannounce&tr=http%3A%2F%2Fopen.acgnxtracker.com%3A80%2Fannounce&tr=http%3A%2F%2Ffxtt.ru%3A80%2Fannounce&tr=http%3A%2F%2Ffosstorrents.com%3A6969%2Fannounce&tr=http%3A%2F%2Fbt.okmp3.ru%3A2710%2Fannounce&tr=http%3A%2F%2F1337.abcvg.info%3A80%2Fannounce&tr=udp%3A%2F%2F93.158.213.92%3A1337%2Fannounce&tr=http%3A%2F%2F93.158.213.92%3A1337%2Fannounce&tr=udp%3A%2F%2F151.80.120.115%3A2810%2Fannounce&tr=udp%3A%2F%2F23.137.251.45%3A6969%2Fannounce&tr=udp%3A%2F%2F91.216.110.52%3A451%2Fannounce&tr=udp%3A%2F%2F45.154.253.8%3A6969%2Fannounce&tr=udp%3A%2F%2F185.181.60.155%3A80%2Fannounce&tr=udp%3A%2F%2F107.189.11.230%3A6969%2Fannounce&tr=udp%3A%2F%2F61.216.149.33%3A6969%2Fannounce&tr=udp%3A%2F%2F185.230.4.150%3A1337%2Fannounce&tr=udp%3A%2F%2F185.44.82.25%3A1337%2Fannounce&tr=udp%3A%2F%2F198.100.149.66%3A6969%2Fannounce&tr=udp%3A%2F%2F149.202.88.193%3A80%2Fannounce&tr=udp%3A%2F%2F184.105.151.166%3A6969%2Fannounce&tr=udp%3A%2F%2F208.83.20.20%3A6969%2Fannounce&tr=udp%3A%2F%2F207.241.231.226%3A6969%2Fannounce&tr=http%3A%2F%2F95.217.167.10%3A6969%2Fannounce&tr=http%3A%2F%2F61.216.149.33%3A6969%2Fannounce&tr=udp%3A%2F%2F65.21.91.32%3A6969%2Fannounce&tr=udp%3A%2F%2F97.117.75.139%3A9000%2Fannounce&tr=udp%3A%2F%2F74.120.175.165%3A6969%2Fannounce&tr=udp%3A%2F%2F185.102.219.163%3A6969%2Fannounce&tr=udp%3A%2F%2F211.22.29.93%3A80%2Fannounce&tr=udp%3A%2F%2F193.42.111.57%3A9337%2Fannounce&tr=udp%3A%2F%2F156.234.201.18%3A80%2Fannounce&tr=udp%3A%2F%2F209.141.59.16%3A6969%2Fannounce&tr=udp%3A%2F%2F66.94.100.216%3A6969%2Fannounce&tr=udp%3A%2F%2F84.252.75.21%3A6969%2Fannounce&tr=udp%3A%2F%2F171.104.110.21%3A6969%2Fannounce&tr=udp%3A%2F%2F194.53.137.231%3A6969%2Fannounce&tr=udp%3A%2F%2F65.108.63.133%3A80%2Fannounce&tr=udp%3A%2F%2F43.154.2.254%3A6969%2Fannounce&tr=udp%3A%2F%2F93.104.214.40%3A6969%2Fannounce&tr=udp%3A%2F%2F95.217.161.135%3A6969%2Fannounce&tr=udp%3A%2F%2F135.181.197.114%3A1337%2Fannounce&tr=udp%3A%2F%2F113.196.95.160%3A6969%2Fannounce&tr=udp%3A%2F%2F158.39.74.31%3A6969%2Fannounce&tr=udp%3A%2F%2F88.80.28.7%3A6969%2Fannounce&tr=udp%3A%2F%2F178.170.48.154%3A1337%2Fannounce&tr=udp%3A%2F%2F51.158.144.42%3A6969%2Fannounce&tr=udp%3A%2F%2F161.97.67.210%3A6969%2Fannounce&tr=udp%3A%2F%2F62.112.11.37%3A6969%2Fannounce&tr=udp%3A%2F%2F158.101.161.60%3A3131%2Fannounce&tr=udp%3A%2F%2F109.72.83.209%3A80%2Fannounce&tr=udp%3A%2F%2F180.97.219.76%3A8070%2Fannounce&tr=udp%3A%2F%2F209.126.11.233%3A6969%2Fannounce&tr=udp%3A%2F%2F50.116.14.248%3A6969%2Fannounce&tr=udp%3A%2F%2F5.196.89.204%3A6969%2Fannounce&tr=udp%3A%2F%2F37.187.119.212%3A6969%2Fannounce&tr=udp%3A%2F%2F176.31.250.174%3A6969%2Fannounce&tr=udp%3A%2F%2F198.91.25.157%3A8000%2Fannounce&tr=udp%3A%2F%2F95.31.11.224%3A6969%2Fannounce&tr=udp%3A%2F%2F193.37.214.12%3A6969%2Fannounce&tr=udp%3A%2F%2F107.175.221.194%3A6969%2Fannounce&tr=udp%3A%2F%2F135.125.106.92%3A6969%2Fannounce&tr=udp%3A%2F%2F185.106.94.80%3A6969%2Fannounce&tr=udp%3A%2F%2F5.188.6.45%3A6969%2Fannounce&tr=udp%3A%2F%2F37.187.95.112%3A6969%2Fannounce&tr=udp%3A%2F%2F176.123.1.180%3A6969%2Fannounce&tr=udp%3A%2F%2F179.43.155.30%3A6969%2Fannounce&tr=udp%3A%2F%2F94.243.222.100%3A6969%2Fannounce&tr=udp%3A%2F%2F167.99.185.219%3A6969%2Fannounce&tr=udp%3A%2F%2F41.79.68.156%3A6969%2Fannounce&tr=udp%3A%2F%2F138.3.249.47%3A6969%2Fannounce&tr=udp%3A%2F%2F144.91.88.22%3A6969%2Fannounce&tr=udp%3A%2F%2F172.105.235.127%3A6969%2Fannounce&tr=udp%3A%2F%2F101.43.174.230%3A6969%2Fannounce&tr=udp%3A%2F%2F95.216.74.39%3A6969%2Fannounce&tr=udp%3A%2F%2F88.99.2.212%3A6969%2Fannounce&tr=udp%3A%2F%2F148.251.53.72%3A6969%2Fannounce&tr=udp%3A%2F%2F89.58.49.71%3A6969%2Fannounce&tr=udp%3A%2F%2F51.68.174.87%3A6969%2Fannounce&tr=udp%3A%2F%2F103.122.21.50%3A6969%2Fannounce&tr=udp%3A%2F%2F77.68.20.254%3A6969%2Fannounce&tr=udp%3A%2F%2F37.59.48.81%3A6969%2Fannounce&tr=udp%3A%2F%2F119.28.71.45%3A8080%2Fannounce&tr=udp%3A%2F%2F104.131.98.232%3A6969%2Fannounce&tr=udp%3A%2F%2F61.164.110.198%3A6969%2Fannounce&tr=udp%3A%2F%2F207.241.226.111%3A6969%2Fannounce&tr=udp%3A%2F%2F51.159.54.68%3A6666%2Fannounce&tr=udp%3A%2F%2F82.65.115.10%3A6969%2Fannounce&tr=udp%3A%2F%2F46.138.242.240%3A6969%2Fannounce&tr=udp%3A%2F%2F61.190.182.107%3A6969%2Fannounce&tr=udp%3A%2F%2F51.15.79.209%3A6969%2Fannounce&tr=http%3A%2F%2F97.117.75.139%3A9000%2Fannounce&tr=http%3A%2F%2F83.6.234.75%3A6969%2Fannounce&tr=http%3A%2F%2F95.107.48.115%3A80%2Fannounce&tr=http%3A%2F%2F211.22.29.93%3A80%2Fannounce&tr=http%3A%2F%2F156.234.201.18%3A80%2Fannounce&tr=http%3A%2F%2F171.104.110.21%3A6969%2Fannounce&tr=http%3A%2F%2F95.217.161.135%3A80%2Fannounce&tr=http%3A%2F%2F159.69.65.157%3A6969%2Fannounce&tr=http%3A%2F%2F47.243.23.189%3A6969%2Fannounce&tr=http%3A%2F%2F180.97.219.76%3A8070%2Fannounce&tr=http%3A%2F%2F177.198.118.240%3A6969%2Fannounce&tr=http%3A%2F%2F51.81.200.170%3A6699%2Fannounce&tr=http%3A%2F%2F212.6.3.67%3A80%2Fannounce&tr=http%3A%2F%2F209.209.112.121%3A2710%2Fannounce&tr=wss%3A%2F%2Ftracker.files.fm%3A7073%2Fannounce&tr=wss%3A%2F%2Ftracker.btorrent.xyz&tr=ws%3A%2F%2Ftracker.files.fm%3A7072%2Fannounce','')
    }
}
function SearchCtrl($scope, $http, $routeParams, $log, $sce, $location) {

    $scope.maxPagesToShow = 5;
    $scope.resultsPerPage = 10;
    $scope.page = 1;

    $scope.searchSyntax = function() {
        $scope.numPages = 0;
        $location.search('q', $scope.syntax);
        $location.search('p', $scope.page);
        $scope.results = null;
        from = ($scope.page-1)*$scope.resultsPerPage;
        $http.post('/api/' + $scope.indexName + '/_search', {
            "size": $scope.resultsPerPage,
            "from": from,
            "explain": true,
            "highlight":{},
            "query": {
                "boost": 1.0,
                "query": $scope.syntax,
            },
            "fields": ["*"]
        }).
        success(function(data) {
            $scope.processResults(data);
        }).
        error(function(data, code) {
            $scope.errorMessage = data;
        });
    };

    if($location.search().p !== undefined) {
        page = parseInt($location.search().p,10);
        if (typeof page == 'number' && !isNaN(page) && isFinite(page) && page > 0 ){
            $scope.page = page;
        }
    }
    if($location.search().q !== undefined) {
        $scope.syntax = $location.search().q;
        $scope.searchSyntax();
    }

    

    $scope.expl = function(explanation) {
            rv = "" + $scope.roundScore(explanation.value) + " - " + explanation.message;
            rv = rv + "<ul>";
            for(var i in explanation.children) {
                    child = explanation.children[i];
                    rv = rv + "<li>" + $scope.expl(child) + "</li>";
            }
            rv = rv + "</ul>";
            return rv;
    };

    $scope.roundScore = function(score) {
            return Math.round(score*1000)/1000;
    };

    $scope.roundTook = function(took) {
        if (took < 1000 * 1000) {
            return "<1ms";
        } else if (took < 1000 * 1000 * 1000) {
            return "" + Math.round(took / (1000*1000)) + "ms";
        } else {
            roundMs = Math.round(took / (1000*1000));
            return "" + roundMs/1000 + "s";
        }
	};

    $scope.setupPager = function(results) {
        $scope.numPages = Math.ceil(results.total_hits/$scope.resultsPerPage);
        $scope.validPages = [];
        for (i = 1; i <= $scope.numPages; i++) {
            $scope.validPages.push(i);
        }


        // now see if we have too many pages
        if ($scope.validPages.length > $scope.maxPagesToShow) {
            numPagesToRemove = $scope.validPages.length - $scope.maxPagesToShow;
            frontPagesToRemove = backPagesToRemove = 0;
            while (numPagesToRemove - frontPagesToRemove - backPagesToRemove > 0) {
                numPagesBefore = $scope.page - 1 - frontPagesToRemove;
                numPagesAfter = $scope.validPages.length - $scope.page - backPagesToRemove;
                if (numPagesAfter > numPagesBefore) {
                    backPagesToRemove++;
                } else {
                    frontPagesToRemove++;
                }
            }

            // remove from the end first, to keep indexes simpler
            $scope.validPages.splice(-backPagesToRemove, backPagesToRemove);
            $scope.validPages.splice(0, frontPagesToRemove);
        }
        $scope.firstResult = (($scope.page-1) * $scope.resultsPerPage) + 1;
    };

    $scope.processResults = function(data) {
        $scope.errorMessage = null;
        $scope.results = data;
        $scope.setupPager($scope.results);
        for(var i in $scope.results.hits) {
                hit = $scope.results.hits[i];
                hit.roundedScore = $scope.roundScore(hit.score);
                hit.explanationString = $scope.expl(hit.explanation);
                hit.explanationStringSafe = $sce.trustAsHtml(hit.explanationString);
                for(var ff in hit.fragments) {
                    fragments = hit.fragments[ff];
                    newFragments = [];
                    for(var ffi in fragments) {
                        fragment = fragments[ffi];
                        safeFragment = $sce.trustAsHtml(fragment);
                        newFragments.push(safeFragment);
                    }
                    hit.fragments[ff] = newFragments;
                }
                if (!hit.fragments) {
                    hit.fragments = {};
                }
                for(var fv in hit.fields) {
                    fieldval = hit.fields[fv];
                    if (hit.fragments[fv] === undefined) {
                        hit.fragments[fv] = [$sce.trustAsHtml(""+fieldval)];
                    }
                }
        }
        $scope.results.roundTook = $scope.roundTook(data.took);
    };

    $scope.jumpToPage = function(pageNum, $event) {
        if ($event) {
            $event.preventDefault();
        }

        $scope.page = pageNum;
        $scope.searchSyntax();
    };

}